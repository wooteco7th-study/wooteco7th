# 📋 기능 목록

### 결제 시스템

- 구매자의 **할인 혜택**과 **재고 상황**을 고려하여 **최종 결제 금액**을 계산하고 안내
- `최종 결제 금액` : 사용자가 입력한 상품의 **가격**과 **수량**을 기반
    - `총구매액`: 상품별 가격 * 수량
    - `프로모션` 및 `멤버십 할인 정책`을 반영

## 보유 상품 출력

- [x]  기능 1 : 파일 입력받기
    - 상품 목록 : `src/main/resources/products.md`
    - 행사 목록 : `src/main/resources/promotions.md`
- [x]  기능 2: 환영 인사와 함께 상품명, 가격, 프로모션 이름, 재고 출력하기
    - [x]  만약 재고가 0개라면 `재고 없음`을 출력한다.
    - [x]  파일에 프로모션 상품만 있더라도, 일반 상품은 `"재고 없음"`으로 출력한다.
        - **일반 상품은 무조건 출력해야한다.**
        - 프로모션 상품 가격과 일반 상품 가격은 같다고 유추 가능
- 입력/ 출력 형식
    - `콜라 1,000원 10개 탄산2+1`
- 예외

### Promotion

- 필드
    - 이름
    - buy (a)
    - get (b)
    - 프로모션 시작 날짜
    - 프로모션 종료 날짜
- 특징
    - [x]  객체의 요소들이 중복 저장 불가능
    - [x]  기본값이 존재 -> 프로모션이 없을 경우 NONE 객체

### PromotionType

- enum

### Promotions

- 필드
    - `List<Promotion>`

### Inventory

- 필드
    - `Map<String, Stocks>` 상품별 재고

### Stocks

- 필드
    - `상품 가격`
    - `일반 재고 수량`
    - `프로모션 재고 수량`
    - `Promotion`
    - `PromotionType`
- 기능
    - 프로모션 기간 중이라면 **프로모션 재고**를 우선적으로 차감한다.
    - 프로모션 재고가 부족할 경우에는 **일반 재고**를 사용한다.

> `ApplicationTest`를 보면 일반 재고가 없을 경우 프로모션 재고와 가격, 상품명이 같고 “재고 없음”으로 출력한다.
>

→ 프로모션과 일반 상품의 가격은 같다.

→ 굳이 두 가격을 분리시킬 필요가 없다.

### InventoryDto

- 출력용 인벤토리 dto

## 구매할 상품명과 수량 입력

- [x]  기능 1 : 구매할 상품명과 수량 입력
- 케이스 :
    - 수량은 하이픈(-)
    - 개별 상품은 대괄호([])로 묶어 쉼표(,)로 구분
- 입력/ 출력 형식
    - `[콜라-3],[에너지바-5]`
- 예외
    - [x]  상품명
        - [x]  주문 상품명이 중복될 경우
        - [x]  상품명이 존재하지 않는 경우 : `[ERROR] 존재하지 않는 상품입니다. 다시 입력해 주세요.`
    - [x]  수량
        - [x]  숫자가 아닌 경우
        - [x]  0 이하인 경우
        - [x]  상품의 재고 총 수량(프로모션 재고 + 일반 재고)을 초과한 경우 (구매 수량이 재고 수량을 초과한 경우) `[ERROR] 재고 수량을 초과하여 구매할 수 없습니다. 다시 입력해 주세요.`
    - [x]  입력 형식
        - [x]  구매할 상품과 수량 형식이 올바르지 않은 경우: ``[ERROR] 올바르지 않은 형식으로 입력했습니다. 다시 입력해 주세요.`

### Order

- 주문

### Orders

- `List<Order>`

## 프로모션에 따른 안내

- [x]  기능 1: 프로모션 적용에 따른 안내
    - [x]  **프로모션 재고가 부족**하여 **일부 수량을 프로모션 혜택 없이 결제**해야 하는 경우, **일부 수량에 대해 정가로 결제하게 됨을 안내**한다.
    - [x]  프로모션 적용이 가능한 상품에 대해 **고객이 해당 수량보다 적게 가져온 경우** : 필요한 수량을 **추가로 가져오면 혜택을 받을 수 있음을 안내**
        - [x]  프로모션 재고가 없을 경우 안내하지 않는다.

### 재고 관리

- 각 상품의 `재고 수량`을 고려하여 `결제가능 여부`를 확인
    - 고객이 상품을 구매할 때마다, **결제된 수량만큼 해당 상품의 재고에서 차감**하여 수량을 관리
    - 재고를 차감함으로써 시스템은 최신 재고 상태를 유지
    - 다음 고객이 구매할 때 정확한 재고 정보를 제공

### 프로모션 할인

- `오늘 날짜`가 `프로모션 기간 내`에 포함된 경우에만 할인을 적용
- N개 구매 시 1개 무료 증정(Buy N Get 1 Free) : `1+1` 또는 `2+1` 프로모션
    - 각각 지정된 상품에 적용
- [x]  동일 상품에 여러 프로모션이 적용되지 않는다.
    - [x]  한 상품에는 하나의 프로모션만 적용된다.

> 여러 프로모션이 존재할 경우 프로모션 적용 이후 다음 프로모션 적용하지 않고 일반 적용?
>
- 프로모션 혜택은 **프로모션 재고 내에서만 적용**
- [x]  프로모션 기간 중이라면 **프로모션 재고**를 우선적으로 차감한다.
    - 프로모션 재고가 부족할 경우에는 **일반 재고**를 사용한다.

> 프로모션 기간이 아니라면 프로모션 재고, 일반 재고 어떤 재고를 사용해도 상관 X ?
>

> 일반 재고만 사용
>
- [x]  프로모션 적용이 가능한 상품에 대해 **고객이 해당 수량보다 적게 가져온 경우**, 필요한 수량을 **추가로 가져오면 혜택을 받을 수 있음을 안내**한다.
    - 1+1
        - 1개를 구매하면 1개를 증정받을 수 있다고 안내한다.
        - 2개를 구매하면 안내 X
        - 3개를 구매하면 1개를 증정받을 수 있다고 안내한다.
    - 2+1
        - 2개를 구매하면 1개를 증정받을 수 있다고 안내한다.
        - 3개를 구매하면 안내 X
        - 4개를 구매하면 안내 X
        - 5개를 구매하면 1개를 증정받을 수 있다고 안내한다.
        - 6개를 구매하면 안내 X
    - n개 구매 a+b 프로모션 : `n % (a+b) == a` 일 경우 1개를 증정받을 수 있다고 안내

> 프로모션 적용이 가능하다? => 프로모션 기간 내 + 프로모션 재고 존재 + 최소 구매 기준 충족
= 증정 상품이 존재한다.
증정 상품이 존재하는데 가져오지 않은 경우 -> 2+1일 경우 2개만 구매한 경우
프로모션 재고가 없을 경우 증정 상품 안내 X
>
- [x]  **프로모션 재고가 부족**하여 **일부 수량을 프로모션 혜택 없이 결제**해야 하는 경우, **일부 수량에 대해 정가로 결제하게 됨을 안내**한다.
    - 프로모션 재고가 7개이고 구매 상품 수가 10개일때 (6개(2+1)+(2+1))는 프로모션이 적용되지만 나머지 4개는 적용되지 않는다.
    - n개 구매, 프로모션 재고 s개 : `n - (s / (a+b) * (a+b))` 개는 프로모션 적용 X, `s / (a+b) * (a+b)`는 프로모션 적용

### PromotionProcessor

- 기능
    - `오늘 날짜`가 `프로모션 기간 내`에 포함되었는지 확인
    - 프로모션 적용이 가능한 상품에 대해 **고객이 해당 수량보다 적게 가져온 경우**, 필요한 수량을 **추가로 가져오면 혜택을 받을 수 있음을 안내**
    - **프로모션 재고가 부족**하여 **일부 수량을 프로모션 혜택 없이 결제**해야 하는 경우, **일부 수량에 대해 정가로 결제하게 됨을 안내**

### PurchaseStateDto

- `record`
- 구매 상태 관리
- 필드
    - 상품명
    - 프로모션 적용 수량
    - 일반 재고 적용 수량
    - 보너스 수량
    - 금액

### Answer

- enum
- Y, N

## 멤버십 할인 여부 입력

- [x]  기능 1 : 멤버십 할인 여부 입력

## 케이스 :

- 입력/ 출력 형식
    - Y 또는 N
- 예외
    - [x]  Y 또는 N이 아닌 문자

### 멤버십 할인

- `멤버십 회원`은 `프로모션 미적용 금액의 30%를 할인`
    - **프로모션 적용 후 남은 금액**에 대해 멤버십 할인을 적용

> 프로모션 적용 후 남은 금액이란  : 프로모션 할인을 적용받지 못한 상품 + 프로모션이 적용되지 않고 정가 결제된 상품
>
- 최대 한도는 `8,000원`

### ResultCalculator

- 필드 : `List<PurchaseStateDto>`
- 기능
    - 프로모션 미적용 상품과 그 개수를 통해 프로모션 미적용 금액 계산
    - 멤버십 비용 계산 (최대 한도 8000원 내)
    - 총구매액, 행사할인, 멤버십할인, 내실돈 계산

## 영수증 출력

- [x]  기능 1 : 영수증 출력
- 입력/ 출력 형식

```java

==============W 편의점================
상품명		수량	금액
오렌지주스		2 	3,600
=============증	정===============
오렌지주스		1
====================================
총구매액		2	3,600
행사할인			-1,800
멤버십할인			-0
내실돈			 1,800

감사합니다. 구매하고 싶은 다른 상품이 있나요? (Y/N)
N

```

### 영수증

- 고객의 `구매 내역`과 `할인`을 요약하여 출력
    - 구매 내역
    - 산출한 금액 정보
- 항목
    - `구매 상품 내역`: 구매한 상품명, 수량, 가격
    - `증정 상품 내역`: 프로모션에 따라 무료로 제공된 증정 상품의 목록
    - 금액 정보
        - `총구매액`: 구매한 상품의 총 수량과 총 금액
        - `행사할인`: 프로모션에 의해 할인된 금액
        - `멤버십할인`: 멤버십에 의해 추가로 할인된 금액
        - `내실돈`:최종 결제 금액
- 영수증의 구성 요소를 보기 좋게 `정렬`
- 영수증 출력 후 **추가 구매를 진행할지 또는 종료할지를 선택**

### ReceiptProductDto

- 필드
    - 구매 상품 - `List<상품명 수량 금액>`
    - 증정 상품 - `List<상품명 수량 금액>`
- `List<PurchaseStateDto>`로 생성

### ReceiptResultDto

- 필드
    - 총구매액
    - 행사할인
    - 멤버십할인
    - 내실돈
- `List<PurchaseStateDto>`로 생성

## 추가 거래 여부 입력

- [x]  기능 1 : 추가 거래 여부 입력
- 입력/ 출력 형식
    - Y 또는 N
- 예외
    - [x]  올바르지 않은 입력 형식의 경우
    - [x]  Y 또는 N이 아닌 문자

## 예외 메세지

- [x]  사용자가 잘못된 값을 입력했을 때, `"[ERROR]"`로 시작하는 오류 메시지와 함께 상황에 맞는 안내를 출력한다.
- [x]  구매할 상품과 수량 형식이 올바르지 않은 경우: `[ERROR] 올바르지 않은 형식으로 입력했습니다. 다시 입력해 주세요.`
- [x]  존재하지 않는 상품을 입력한 경우: `[ERROR] 존재하지 않는 상품입니다. 다시 입력해 주세요.`
- [x]  구매 수량이 재고 수량을 초과한 경우: `[ERROR] 재고 수량을 초과하여 구매할 수 없습니다. 다시 입력해 주세요.`
- [x]  기타 잘못된 입력의 경우: `[ERROR] 잘못된 입력입니다. 다시 입력해 주세요.`

### 입력 기능

- 파일 입력
    - 상품 목록 : `src/main/resources/products.md`
    - 행사 목록 : `src/main/resources/promotions.md`
    - 두 파일 모두 내용의 형식을 유지한다면 값은 수정할 수 있다.
- 구매할 상품과 수량 입력
- 프로모션 적용이 가능한 상품에 대해 고객이 해당 수량보다 적게 가져온 경우, 그 수량만큼 **추가 여부를 입력**
    - 증정 받을 수 있는 상품 추가 / 추가 X
- 프로모션 재고가 부족하여 일부 수량을 프로모션 혜택 없이 결제해야 하는 경우, **일부 수량에 대해 정가로 결제할지 여부를 입력**받는다.
    - 일부 수량 정가 결제 / 일부 수량 제외
- 멤버십 할인 여부 입력
    - 할인 적용 / 할인 적용 X
- 추가 구매 여부 입력
    - 추가 구매 진행 / 구매 종료
- [x]  재입력
    - [x]  사용자가 잘못된 값을 입력할 경우 IllegalArgumentException를 발생시키고, `"[ERROR]"`로 시작하는 에러 메시지를 출력 후 **해당 부분부터 다시 입력을 받는다.**
    - [x]  재입력 위치
        - 예외 발생 부분부터 다시 입력받기

### 출력 기능

- 환영 인사와 함께 상품명, 가격, 프로모션 이름, 재고를 안내한다.
- 프로모션 적용이 가능한 상품에 대해 고객이 해당 수량만큼 가져오지 않았을 경우, 혜택에 대한 안내 메시지를 출력한다.
    - `현재 {상품명}은(는) 1개를 무료로 더 받을 수 있습니다. 추가하시겠습니까? (Y/N)`
- 프로모션 재고가 부족하여 일부 수량을 프로모션 혜택 없이 결제해야 하는 경우, 일부 수량에 대해 **정가로 결제할지 여부**에 대한 안내 메시지를 출력한다.
    - `현재 {상품명} {수량}개는 프로모션 할인이 적용되지 않습니다. 그래도 구매하시겠습니까? (Y/N)`
- 멤버십 할인 적용 여부
    - `멤버십 할인을 받으시겠습니까? (Y/N)`
- 구매 상품 내역, 증정 상품 내역, 금액 정보를 출력한다.
- 추가 구매 여부를 확인하기 위해 안내 문구를 출력한다.
    - `감사합니다. 구매하고 싶은 다른 상품이 있나요? (Y/N)`
- [x]  재입력
- [x]  프로그래밍 실행 결과 예시와 동일하게 입력과 출력이 이루어져야 한다.

### 💻 프로그래밍 실행 결과 예시

```
안녕하세요. W편의점입니다.
현재 보유하고 있는 상품입니다.

- 콜라 1,000원 10개 탄산2+1
- 콜라 1,000원 10개
- 사이다 1,000원 8개 탄산2+1
- 사이다 1,000원 7개
- 오렌지주스 1,800원 9개 MD추천상품
- 오렌지주스 1,800원 재고 없음
- 탄산수 1,200원 5개 탄산2+1
- 탄산수 1,200원 재고 없음
- 물 500원 10개
- 비타민워터 1,500원 6개
- 감자칩 1,500원 5개 반짝할인
- 감자칩 1,500원 5개
- 초코바 1,200원 5개 MD추천상품
- 초코바 1,200원 5개
- 에너지바 2,000원 5개
- 정식도시락 6,400원 8개
- 컵라면 1,700원 1개 MD추천상품
- 컵라면 1,700원 10개

구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])
[콜라-3],[에너지바-5]

멤버십 할인을 받으시겠습니까? (Y/N)
Y

==============W 편의점================
상품명		수량	금액
콜라		3 	3,000
에너지바 		5 	10,000
=============증	정===============
콜라		1
====================================
총구매액		8	13,000
행사할인			-1,000
멤버십할인			-3,000
내실돈			 9,000

감사합니다. 구매하고 싶은 다른 상품이 있나요? (Y/N)
Y

안녕하세요. W편의점입니다.
현재 보유하고 있는 상품입니다.

- 콜라 1,000원 7개 탄산2+1
- 콜라 1,000원 10개
- 사이다 1,000원 8개 탄산2+1
- 사이다 1,000원 7개
- 오렌지주스 1,800원 9개 MD추천상품
- 오렌지주스 1,800원 재고 없음
- 탄산수 1,200원 5개 탄산2+1
- 탄산수 1,200원 재고 없음
- 물 500원 10개
- 비타민워터 1,500원 6개
- 감자칩 1,500원 5개 반짝할인
- 감자칩 1,500원 5개
- 초코바 1,200원 5개 MD추천상품
- 초코바 1,200원 5개
- 에너지바 2,000원 재고 없음
- 정식도시락 6,400원 8개
- 컵라면 1,700원 1개 MD추천상품
- 컵라면 1,700원 10개

구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])
[콜라-10]

현재 콜라 4개는 프로모션 할인이 적용되지 않습니다. 그래도 구매하시겠습니까? (Y/N)
Y

멤버십 할인을 받으시겠습니까? (Y/N)
N

==============W 편의점================
상품명		수량	금액
콜라		10 	10,000
=============증	정===============
콜라		2
====================================
총구매액		10	10,000
행사할인			-2,000
멤버십할인			-0
내실돈			 8,000

감사합니다. 구매하고 싶은 다른 상품이 있나요? (Y/N)
Y

안녕하세요. W편의점입니다.
현재 보유하고 있는 상품입니다.

- 콜라 1,000원 재고 없음 탄산2+1
- 콜라 1,000원 7개
- 사이다 1,000원 8개 탄산2+1
- 사이다 1,000원 7개
- 오렌지주스 1,800원 9개 MD추천상품
- 오렌지주스 1,800원 재고 없음
- 탄산수 1,200원 5개 탄산2+1
- 탄산수 1,200원 재고 없음
- 물 500원 10개
- 비타민워터 1,500원 6개
- 감자칩 1,500원 5개 반짝할인
- 감자칩 1,500원 5개
- 초코바 1,200원 5개 MD추천상품
- 초코바 1,200원 5개
- 에너지바 2,000원 재고 없음
- 정식도시락 6,400원 8개
- 컵라면 1,700원 1개 MD추천상품
- 컵라면 1,700원 10개

구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])
[오렌지주스-1]

현재 오렌지주스은(는) 1개를 무료로 더 받을 수 있습니다. 추가하시겠습니까? (Y/N)
Y

멤버십 할인을 받으시겠습니까? (Y/N)
Y

==============W 편의점================
상품명		수량	금액
오렌지주스		2 	3,600
=============증	정===============
오렌지주스		1
====================================
총구매액		2	3,600
행사할인			-1,800
멤버십할인			-0
내실돈			 1,800

감사합니다. 구매하고 싶은 다른 상품이 있나요? (Y/N)
N

```

# 🎱 프로그래밍 요구사항

### 코드 컨벤션

- [x]  indent(인덴트, 들여쓰기) depth를 3이 넘지 않도록 구현 (2까지만 허용)
- [x]  3항 연산자 사용 금지
- [x]  함수(또는 메서드)의 길이가 **10라인**을 넘지 않도록 구현
- [x]  else 예약어 사용 금지

### 구현

- [x]  클래스 활용
    - [x]  InputView, OutputView 참고
    - [x]  클래스 이름, 메소드 반환 유형, 시그니처 등은 자유롭게 수정할 수 있다.

```java
public class InputView {
    public String readItem() {
        System.out.println("구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])");
        String input = Console.readLine();
        // ...
    }
    // ...
}

```

```java
public class OutputView {
    public void printProducts() {
        System.out.println("- 콜라 1,000원 10개 탄산2+1");
        // ...
    }
    // ...
}

```

- [x]  도메인 로직에 단위 테스트 구현 (UI 로직 제외)
- [x]  Java `Enum` 적용
- [x]  핵심 로직과 UI 로직을 분리해 구현
    - [x]  `InputView`: 입력 처리
    - [x]  `OutputView`: 출력 처리

### 라이브러리

- [x]  `camp.nextstep.edu.missionutils`에서 제공하는 `DateTimes` 및 `Console` API를 사용하여 구현해야 한다.
    - 현재 날짜와 시간을 가져오려면 `camp.nextstep.edu.missionutils.DateTimes`의 `now()`를 활용한다.
    - 사용자가 입력하는 값은 `camp.nextstep.edu.missionutils.Console`의 `readLine()`을 활용한다.

### 체크리스트

- [x]  테스트코드를 보고 흐름에 맞춰 설계하였는가?
- [x]  요구사항에서 구현 순서가 존재할때, 구현 순서를 따라 개발하였는가?
- [x]  랜덤 라이브러리 사용시 범위를 적절하게 고려하였는가?
- [x]  테스트 시간 초과 되지 않도록 고려하였는가?
- [x]  한 조건이 여러 케이스를 포함하지는 않는가?
